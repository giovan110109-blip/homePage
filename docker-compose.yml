version: '3.8'

services:
  # 前端服务
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
      args:
        - VITE_API_BASE_URL=${VITE_API_BASE_URL}
        - VITE_SITE_TITLE=${VITE_SITE_TITLE}
        - VITE_SITE_DESCRIPTION=${VITE_SITE_DESCRIPTION}
        - VITE_API_BASE_URL_LOCAL=${VITE_API_BASE_URL_LOCAL}
    container_name: homepage-client
    ports:
      - "40000:80"
    restart: unless-stopped
    networks:
      - homepage-network
    # depends_on:
    #   - server

  # 后端服务
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: homepage-server
    ports:
      - "8998:8998"
    restart: unless-stopped
    networks:
      - homepage-network
    environment:
      - NODE_ENV=production
      - PORT=${PORT:-8998}
      # 在 Docker 容器中，使用容器内部的挂载路径
      - UPLOAD_DIR=/app/uploads
      - UPLOAD_BASE_URL=/uploads
    env_file:
      - .env
    volumes:
      # 将外接硬盘挂载到容器中，使容器可以访问外接硬盘的 uploads 目录
      - /Volumes/大金刚/uploads:/app/uploads
    # depends_on:
    #   - mongodb

  # MongoDB 数据库
  # mongodb:
  #   image: mongo:7-jammy
  #   container_name: homepage-mongodb
  #   ports:
  #     - "27017:27017"
  #   restart: unless-stopped
  #   networks:
  #     - homepage-network
  #   environment:
  #     - MONGO_INITDB_ROOT_USERNAME=${MONGO_USERNAME:-admin}
  #     - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD:-password}
  #   volumes:
  #     # 持久化数据库数据
  #     - mongodb-data:/data/db
  #     - mongodb-config:/data/configdb

networks:
  homepage-network:
    driver: bridge

volumes:
  mongodb-data:
    driver: local
  mongodb-config:
    driver: local
